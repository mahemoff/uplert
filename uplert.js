const r2 = require("r2");
const url = `https://api.up.com.au/api/v1/accounts/${process.env.UP_ACCOUNT_ID}`
let minBalance = 200;

//////////////////////////////////////////////////////////////////////////////
// GENERIC HTTP
//////////////////////////////////////////////////////////////////////////////

const httpGet = async (url, headers) => {
  try {
    const response = await r2(url, {headers}).json;
    return response.data;
  } catch (error) {
    console.log(error);
  }
};

//////////////////////////////////////////////////////////////////////////////
// GENERIC UPBANK API
//////////////////////////////////////////////////////////////////////////////

const getUp = async (path) => {
  const url = `https://api.up.com.au/api/v1/${path}`
  const response = await httpGet(url, {'Authorization': process.env.UP_KEY});
  let balance = response.attributes.balance.value;
  console.log ( `Balance ${(balance < minBalance) ? 'low!' : 'OK'}` );
};

//////////////////////////////////////////////////////////////////////////////
// PAYMENTS
//////////////////////////////////////////////////////////////////////////////

getUp(`/accounts/${process.env.UP_ACCOUNT_ID}`);
